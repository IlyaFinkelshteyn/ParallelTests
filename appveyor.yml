version: 1.0.{build}

environment:
  API_KEY:
    secure: YIuqOcciVmoaQJhMWRoknEDuDMTUJ+oMnHCXQmBlgv4=
  TimeOutMins: 5
    
install:
- cmd: nuget restore

build:
  verbosity: minimal

test:
  categories:
  - - C1
  - - C2
  - - C3
  - - C4


before_deploy:
- ps: "if ($env:APPVEYOR_JOB_NUMBER -ne 1) {return}\n\nwrite-host \"skip waiting for other jobs to complete\"\n\n[datetime]$stop = ([datetime]::Now).AddMinutes($TimeOutMins)\n[bool]$success = $false\n\nwhile(!$success -and ([datetime]::Now) -lt $stop) {\n\n    $project = Invoke-RestMethod -Uri \"https://ci.appveyor.com/api/projects/$AccountName/$ProjectSlug\" -Headers $headers -Method GET\n\n    $project.build.jobs | foreach-object {$_.status}\n    \n    $success = $false # todo\n    if (!$success) {Start-sleep 5}\n}\n\nif (!$success) {throw \"Test jobs were not finished in $TimeOutMins minutes\"}"

